{% extends 'TitulacionSisAcademicoBundle:Home:index.html.twig' %}
{% block home %}  



  <!-- Main content -->
  <section class="content">
    <div class="col-md-3">&nbsp;</div>
    <div class="col-md-6">
      <!-- general form elements -->
      <div class="box box-primary">
        <div class="box-header with-border">
          <h3 class="box-title">Cambio Contraseña</h3>
        </div>
        <!-- /.box-header -->
        <!-- form start -->
        <form role="form">
          <div class="box-body">

            <div class="cambioContrasenia">
              <p>Estimado Usuario, la clave ingresada debe considerar los siguientes requisitos.<br />
              </p>
              <p>&nbsp;&nbsp;-  El primer carácter debe ser alfanumérico en mayúsculas</p>
              <p>&nbsp;&nbsp;-  Longitud 8 caracteres que contengan al menos tres de las siguientes caracteristicas:<br />
              </p>
              <ul>
                <li>  Letras abecedario Mayúsculas (A-Z).</li>
                <li>  Letras abecedario minúsculas (a-z).</li>
                <li>  Números (0-9) o Caracteres especiales.</li>
              </ul>
              <br/>
            </div>

            <div class="form-group">
              <label for="InputPassword">Contraseña Actual</label>
              <input type="password" class="form-control" id="password" placeholder="Contraseña" required />
            </div>
            <div class="form-group">
              <label for="InputPassword1">Nueva Contraseña</label>
              <input type="password" class="form-control demo-2" id="password1" placeholder="Nueva Contraseña" onchange="return validaContrasenia(this.id)" required />
            </div>
            <div class="form-group">
              <label for="InputPassword1">Confirme su nueva Contraseña</label>
              <input type="password" class="form-control" id="password2" placeholder="Confirme Contraseña" onchange="return validaContrasenia(this.id)" required />
            </div> 
          </div>
          <!-- /.box-body -->

          <div class="box-footer">
            <a href="#" onclick="cambiarContrasenia();"  class="btn btn-primary">Aceptar</a>
          </div>
        </form>
      </div>
      <!-- /.box -->
    </div>
    <div class="col-md-3">&nbsp;</div>
  </section>
  <!-- /.content -->


<script type="text/javascript">

$(document).ready(function ($) {
 $('.demo-2').bootstrapStrength({slimBar:true});
});


function validaContrasenia(idCaja){
  expr = /(?=^[A-Z].{8,}$)(?=.*\d)(?=.*\W+)(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/
  band = true;
  stringvalue = $("#"+idCaja).val();
  if(stringvalue != ""){
    if (!expr.test(stringvalue))
    {
       mensaje_cisc( "error", "Contraseña invalida.");
        $("#"+idCaja).val('');
        band = false;
    }
  }
  return band;
}

function cambiarContrasenia(){
  var bandValid = 0;
    var msgError = "";

    $("#password").val($.trim($("#password").val()));
    $("#password1").val($.trim($("#password1").val()));
    $("#password2").val($.trim($("#password2").val()));


      if($("#password").val() == $("#password1").val())
        {
          msgError = "Su nueva contraseña debe ser diferente a la actual.";
          $("#password1").val('') ;
          bandValid = 1;
        }else{
          if($("#password1").val() != $("#password2").val())
            {
              msgError = "Las contraseñas no coinciden.";
              $("#password2").val('') ;
              bandValid = 1;
            }
       }
    

    if(bandValid == 1){
        mensaje_cisc( "error", msgError);
    }else{
      var modelessCambioPassword;
      $.ajax({
        url:   '{{path('admin_academico_ingreso_nuevo_int_pass')}}',
        data: {'pass': $("#password").val(),'pass1': $("#password1").val()},
        type:  'post',
        beforeSend: function () {
          modelessCambioPassword = new $.flavr({
            modal   : true,
            content : '<i class="fa fa-refresh fa-spin"/> &nbsp;<b>Cargando...</b>',
            buttons     : {}
            });
        },
        error:function(){
          modelessCambioPassword.close();                       
            mensaje_cisc( "error", "En estos momentos tenemos problemas con los servidores, lamentamos los inconvenientes");
        },
        success:  function (dataResponse) {
          modelessCambioPassword.close();
           var codigo = JSON.parse(dataResponse).Codigo[0];
           var mensaje = JSON.parse(dataResponse).Mensaje[0];

            if (codigo == "1") {
               mensaje_cisc( "notice", "Contraseña cambiada correctamente");
               $("#password2").val('');
               $("#password1").val('');
               $("#password").val('');
            }
            else{
                mensaje_cisc( "error", mensaje);
                $("#password").val('');
            }
          
        },
        dataType:'html'
        });
    }
}


</script>

{% endblock %}