{% block listadoMaterias %}
<div id="tablaMaterias_{{data.datosCarrera.idCarrera}}" class="table-responsive">

{% if data.datosMaterias|length > 0 %}
   <table class="table table-striped table-bordered">
      <thead>
        <tr>
         <th> Materia </th>
         <th> Paralelo</th>
         <th> Horario</th>
         <th> Inscritos</th>
         <th class="td-actions">Opciones </th>
        </tr>
      </thead>
      <tbody>
      {% for materias in data.datosMaterias %}
        <tr>
         <td id="nombreMateria_{{ materias.id_sa_materia_paralelo }}">{{ materias.materia|upper }}</td>
         <td id="paraleloMateria_{{ materias.id_sa_materia_paralelo }}">{{ materias.paralelo|upper }}</td>
         <td id="jornadaMateria_{{ materias.id_sa_materia_paralelo }}">{{ materias.jornada|upper }}</td>
         <td id="alumnosMateria_{{ materias.id_sa_materia_paralelo }}">{{ materias.cantidad }}</td>
         <td class="td-actions">
            <a id="materiaAsistencias-{{ materias.id_sa_materia_paralelo }}" href="" class="tip asistenciaAlumnos btn btn-primary btn-circle"><span>Hist贸rico de Asistencia de Alumnos</span><i class="fa fa-list"> </i></a>
            <a id="materiasNotas-{{ materias.id_sa_materia_paralelo  }}" href="" class="tip notasAlumnos btn btn-primary btn-circle"><span>Consultas de Notas de los Alumnos</span><i class="fa fa-mortar-board"> </i></a>
            <a id="materiasVision-{{ materias.id_sa_materia_paralelo  }}" href="" class="tip materiasVision btn btn-primary btn-circle"><span>Vista General de la Asignatura</span><i class="fa fa-bar-chart-o"> </i></a></td>
         <input id="Nombre-Materia_{{materias.id_sa_materia_paralelo}}" value="{{ materias.materia|upper }}" type="hidden" >
         <input id="Nombre-Paralelo_{{materias.id_sa_materia_paralelo}}" value="{{ materias.paralelo|upper }}" type="hidden" >
        </tr>
      {% endfor %}
      </tbody>
   </table>
{% else %}
   <table class="table table-striped table-bordered">
      <tbody>
         <tr>
            <td>No se encontraron materias registradas para usted en esta carrera.</td>
         </tr>
      </tbody>
   </table>
{% endif %}
</div>
<!-- /.table-responsive -->
<script type="text/javascript">
   $(document).ready(function(){
      $(".asistenciaAlumnos").on('click', function(event){
         event.preventDefault();
         var materiaSplit  = $(this).attr("id").split("-");
         var idMateria     = materiaSplit[1];
         var idCarrera     = $("#carreraSeleccionada").val();
         var inicioCiclo    = $("#inicioCiclo-Carrera_"+idCarrera).val();
         var finCiclo      = $("#finCiclo-Carrera_"+idCarrera).val();
         var obj_data      = {'idMateria':idMateria,'idCarrera':idCarrera, 'inicioCiclo':inicioCiclo, 'finCiclo':finCiclo};

         var optionSelect        = $(this);

         var jumpOption          = '{{path('docentes_alumnos_asistencias')}}';
         var tituloPanelMateria  = $("#nombreMateria_"+idMateria).html() + " ["+ $("#paraleloMateria_"+idMateria).html() +"]";;

         
         $.ajax({
            url:  jumpOption,
            type: 'post',
            data: obj_data,
            async: false,
            beforeSend: function () {
              //optionSelect.closest(".panel-body").html("Procesando, espere por favor...");
            },
            error: function(){
               //console.log("hay un error");
               var mensajeErrorNotas   = "Lo sentimos. Se  present贸 un problema para cargar el listado de asistencias."
               lanzarModal('Listado de asistencias',mensajeErrorNotas,'Aceptar');//alert(mensajeErrorNotas);
            },
            success:  function (dataResponse) {
              //console.log(optionSelect.closest(".panel-body"));
              $("#materiaSeleccionada-Carrera_"+idCarrera).val(idMateria);
              $("#nombreMateriaSeleccionada-Carrera_"+idCarrera).val(tituloPanelMateria);
              optionSelect.closest(".panel-body").html(dataResponse);
            },
            dataType:'html'
         });
         
         $("#panelInfoAdicional_headerlabel").html(tituloPanelMateria+" <input id='idMateriaSelected' type='hidden' value='"+idMateria+"'> <input id='idCarreradeMateriaSelected' type='hidden' value='"+idCarrera+"'>");
         $("#panelInfoAdicional .panel-body").children().hide();
         $("#menuGeneralDocente").show();
         $("#infoCalendarioDocente").show();
         $("#chartAsistencias").show();
         $("#chartAsistencias").children().show();
         $("#img_demo").show();
      });
      
      $(".notasAlumnos").on('click', function(event){
         event.preventDefault();
         var modelessMaterias;
         var idSplit          = $(this).attr('id').split('-');
         var nombreElemento   = idSplit[0]; 
         var idMateria        = idSplit[1]; 
         //var idDocente        = 1;
         var idCarrera        = $("#carreraSeleccionada").val();
         var tituloPanelMateria  = $("#nombreMateria_"+idMateria).html() + " ["+ $("#paraleloMateria_"+idMateria).html() +"]";
         
         var optionSelect = $(this);
         var jumpOption = '{{path('docentes_notas_alumnos_materia')}}';
          
         //var obj_data = {'idDocente': idDocente,'idMateria':idMateria};
         var obj_data = {'idMateria':idMateria, 'idCarrera':idCarrera,"ciclo":$("#Ciclo-Detalle_"+idCarrera).val(),"nom_materia":$("#Nombre-Materia_"+idMateria).val(),"paralelo":$("#Nombre-Paralelo_"+idMateria).val()};

         $.ajax({
            url:   jumpOption,
            type:  'post',
            data: obj_data,
            async: false,
            beforeSend: function () {
               modelessMaterias = new $.flavr({
                                                modal   : true,
                                                content : '<i class="fa fa-refresh fa-spin"></i> &nbsp;<b>Cargando...</b>',
                                                buttons     : {}
                                             });
            },
            error: function(){
               modelessMaterias.close();
               var mensajeErrorNotas   = "Lo sentimos. Se  present贸 un problema para cargar la consulta de notas.";
               modelessMaterias = new $.flavr({
                                                modal   : true,
                                                content : mensajeErrorNotas,
                                                buttons     : {
                                                   primary : { text: 'Aceptar', style: 'primary' }
                                                }
                                             });
            },
            success:  function (dataResponse) {
              modelessMaterias.close();
              $("#materiaSeleccionada-Carrera_"+idCarrera).val(idMateria);
              optionSelect.closest(".panel-body").html(dataResponse);
            },
            dataType:'html'
         });

         $("#panelInfoAdicional_headerlabel").html(tituloPanelMateria+" <input id='idMateriaSelected' type='hidden' value='"+idMateria+"'> <input id='idCarreradeMateriaSelected' type='hidden' value='"+idCarrera+"'>");
         $("#panelInfoAdicional .panel-body").children().hide();
         $("#menuGeneralDocente").show();
         $("#infoCalendarioDocente").show();
         $("#chartAsistencias").show();
         $("#chartAsistencias").children().show();
         $("#img_demo").show();
      });
      
      $(".materiasVision").on('click', function(event){
         event.preventDefault();
         var idSplit          = $(this).attr('id').split('-');
         var nombreElemento   = idSplit[0]; 
         var idMateria        = idSplit[1]; 
         var idDocente        = 1;
         var idCarrera        = $("#carreraSeleccionada").val();
         
         var optionSelect = $(this);
         var jumpOption = '{{path('docentes_vision_materia')}}';
         
         var obj_data = {'idDocente': idDocente,'idMateria':idMateria};

         $.ajax({
            url:   jumpOption,
            type:  'post',
            data: obj_data,
            async: false,
            beforeSend: function () {
              //optionSelect.closest(".panel-body").html("Procesando, espere por favor...");
            },
            error: function(){
               //console.log("hay un error");
               var mensajeErrorNotas   = "Lo sentimos. Se  present贸 un problema para cargar la vista general de la materia."
               lanzarModal('Vista General de la Materia',mensajeErrorNotas,'Aceptar');
            },
            success:  function (dataResponse) {
              //console.log(optionSelect.closest(".panel-body"));
              optionSelect.closest(".panel-body").html(dataResponse);
            },
            dataType:'html'
         });

         $("#panelInfoAdicional_headerlabel").html(tituloPanelMateria+" <input id='idMateriaSelected' type='hidden' value='"+idMateria+"'> <input id='idCarreradeMateriaSelected' type='hidden' value='"+idCarrera+"'>");
         $("#panelInfoAdicional .panel-body").children().hide();
         $("#menuGeneralDocente").show();
         $("#infoCalendarioDocente").show();
         $("#chartAsistencias").show();
         $("#chartAsistencias").children().show();
         $("#img_demo").show();
      });
   });
</script>
{% endblock %}  